---
title: "main"
output: html_document
---
# load data and needed modules
```{r}
library(tidyverse)
library(ggplot2)
library(sjPlot)
d <- read.csv("wide_form_vowel_means_by_speaker.csv")
w2 <- read.csv("2nd_wave_coding.csv")
q <- read.csv("qualtrics_for_stats.csv")
d <- merge(d,w2, by="speaker")
```

# simplify dataset a bit, drop n/a, select only female speakers
```{r}
eth_subset <- c("Black", "White", "Latinx", "Asian")
d <- d[d$Ethnicity %in% eth_subset,]
d$Ethnicity[grepl(",", d$Ethnicity, fixed = TRUE)] <- "MixedRace"
d$Ethnicity[grepl(",", d$Ethnicity, fixed = TRUE)] <- "MixedRace"
d$is_Greek[d$is_Greek == ""] <- NA
d <- d %>% drop_na(is_Greek)
w <- d[ d$Gender == "Female",]
m <- d[ d$Gender == "Male",]
```

# sample size summary - women
```{r}
sample_summary_women <- w %>%
  group_by(Ethnicity, is_Greek) %>%
  summarise(n = n(), .groups = 'drop') %>%
  pivot_wider(names_from = is_Greek, values_from = n, values_fill = 0)
print("Women (Sorority):")
print(sample_summary_women)
```

# sample size summary - men
```{r}
sample_summary_men <- m %>%
  group_by(Ethnicity, is_Greek) %>%
  summarise(n = n(), .groups = 'drop') %>%
  pivot_wider(names_from = is_Greek, values_from = n, values_fill = 0)
print("Men (Fraternity):")
print(sample_summary_men)
```

# lets look at traits of LBMS comparing Greek vs NonGreek women OVERALL
```{r}
ggplot(w, aes(x= is_Greek, y= Diag_35.TRAP, color = Ethnicity )) +
  geom_point(position = "jitter") 

```

# control for ethnicity 
for some reason wouldn't run without comma

and plots dont show up by default in loops, need to explicitly print 
```{r}

            
for (eth in eth_subset)
  {
    e <- w[w$Ethnicity == eth,]
    n_greek <- sum(e$is_Greek == "yes")
    n_nongreek <- sum(e$is_Greek == "no")
    
    p <- ggplot(e, aes(x= is_Greek, y =Diag_35.TRAP, color = Ethnicity )) +
          geom_point() +
          labs(subtitle = paste0("Greek n=", n_greek, ", Non-Greek n=", n_nongreek))
    print(p)
  }
```
# run linear regressions to see if there is a signifigant affect for greek life
```{r}
run_speaker_level_stats <- function(.df, .meas) {
  metric = .meas[1]
  interpretation = .meas[2]
  print(paste("Model summary for ", metric))
  print(.meas[2])
  additive_model <- lm(as.formula(paste(metric, " ~ is_Greek + Ethnicity")), data=.df)
  print(summary(additive_model))
  plot <- plot_model(additive_model, show.values = TRUE, value.offset = .3) + labs(title = paste("Model for ", metric, "\n ", interpretation))
  print(plot)
  
}

measurements = list(c("Diag_80.PRIZE", "lower/backer=SOUTHERN/AAE"),
                    c("Diag_35.TRAP", "higher/fronter=SOUTHERN/AAE, lower/backer=LBMS"),
              c("Diag_35.HAND", "higher/fronter=LBMS, lower/backer=other"),
                    c("Diag_35.FACE", "lower/backer=SOUTHERN, higher/fronter=LBMS"),
                    c("Diag_35.DRESS", "higher/fronter=SOUTHERN/AAE, lower/backer=LBMS"),
                    c("Z2_35.GOOSE", "higher (fronter)=SOUTHERN/LBMS, lower (backer)=AAE"),
                    c("Z2_35.GOAT", "higher (fronter)=SOUTHERN/LBMS, lower (backer)=AAE"),
              c("lot_thought_pillai", "lower (more MERGED)=LBMS, lower (higher MERGED)=other"),
                  c("pin_pen_pillai", "lower (more MERGED)=SOUTHERN/AAE, higher (less MERGED)=other"))

                  
for (meas in measurements) {
  run_speaker_level_stats(w, meas)
}

```